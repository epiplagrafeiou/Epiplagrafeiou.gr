
const categoryMap: { [key: string]: string[] } = {
    // Office
    'καρεκλες γραφειου': ['ΓΡΑΦΕΙΟ', 'Καρέκλες Γραφείου'],
    'gaming chairs': ['ΓΡΑΦΕΙΟ', 'Καρέκλες Γραφείου'],
    'διευθυντικ': ['ΓΡΑΦΕΙΟ', 'Καρέκλες Γραφείου'],
    'γραφεια': ['ΓΡΑΦΕΙΟ', 'Γραφεία'],
    'βιβλιοθηκες': ['ΓΡΑΦΕΙΟ', 'Βιβλιοθήκες'],
    'ραφιερα': ['ΓΡΑΦΕΙΟ', 'Ραφιέρες'],
    'ραφια': ['ΓΡΑΦΕΙΟ', 'Ραφιέρες'],
    'συρταριερα': ['ΓΡΑΦΕΙΟ', 'Συρταριέρες'],
    'ντουλαπια αρχειοθετηση': ['ΓΡΑΦΕΙΟ', 'Ντουλάπια Αρχείων'],

    // Living Room
    'καναπ': ['ΣΑΛΟΝΙ', 'Καναπέδες'],
    'πολυθρον': ['ΣΑΛΟΝΙ', 'Πολυθρόνες'],
    'τραπεζακια σαλονιου': ['ΣΑΛΟΝΙ', 'Τραπεζάκια Σαλονιού'],
    'επιπλα tv': ['ΣΑΛΟΝΙ', 'Έπιπλα Τηλεόρασης'],
    'συνθεσ': ['ΣΑΛΟΝΙ', 'Συνθέσεις'],
    'σκαμπο': ['ΣΑΛΟΝΙ', 'Σκαμπό & Πουφ'],
    'πουφ': ['ΣΑΛΟΝΙ', 'Σκαμπό & Πουφ'],

    // Bedroom
    'κρεβατ': ['ΚΡΕΒΑΤΟΚΑΜΑΡΑ', 'Κρεβάτια'],
    'στρωμα': ['ΚΡΕΒΑΤΟΚΑΜΑΡΑ', 'Στρώματα'],
    'κομοδιν': ['ΚΡΕΒΑΤΟΚΑΜΑΡΑ', 'Κομοδίνα'],
    'ντουλαπ': ['ΚΡΕΒΑΤΟΚΑΜΑΡΑ', 'Ντουλάπες'],
    'τουαλετες επιπλα': ['ΚΡΕΒΑΤΟΚΑΜΑΡΑ', 'Τουαλέτες'],

    // Dining
    'τραπεζαρια': ['ΤΡΑΠΕΖΑΡΙΑ', 'Τραπέζια'],
    'τραπεζι': ['ΤΡΑΠΕΖΑΡΙΑ', 'Τραπέζια'],
    'καρεκλες κουζινας': ['ΤΡΑΠΕΖΑΡΙΑ', 'Καρέκλες'],
    'καρεκλα τραπεζαριας': ['ΤΡΑΠΕΖΑΡΙΑ', 'Καρέκλες'],
    'μπουφε': ['ΤΡΑΠΕΖΑΡΙΑ', 'Μπουφέδες'],
    'βιτριν': ['ΤΡΑΠΕΖΑΡΙΑ', 'Βιτρίνες'],
    'stool': ['ΤΡΑΠΕΖΑΡΙΑ', 'Stools'],

    // Outdoor
    'επιπλα κηπου': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Σετ Σαλονιού Κήπου'],
    'επιπλα βεραντας': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Σετ Σαλονιού Κήπου'],
    'καρεκλες κηπου': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Καρέκλες Κήπου'],
    'ξαπλωστρ': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Ξαπλώστρες'],
    'αιωρ': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Αιώρες'],
    'πανι σκιαση': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Λύσεις Σκίασης'],
    'τζακι εξωτερικου χωρου': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Τζάκια & Εστίες Φωτιάς'],
    'ψησταρι': ['ΕΞΩΤΕΡΙΚΟΣ ΧΩΡΟΣ', 'Ψησταριές'],

    // Lighting
    'φωτιστικ': ['ΦΩΤΙΣΜΟΣ', 'Γενικά'],
    'led': ['ΦΩΤΙΣΜΟΣ', 'LED'],
    'λαμπτήρ': ['ΦΩΤΙΣΜΟΣ', 'Λάμπες'],

    // Decoration
    'διακοσμητικ': ['ΔΙΑΚΟΣΜΗΣΗ', 'Γενικά'],
    'πινακ': ['ΔΙΑΚΟΣΜΗΣΗ', 'Πίνακες'],
    'φυτα': ['ΔΙΑΚΟΣΜΗΣΗ', 'Φυτά'],
    'κερι': ['ΔΙΑΚΟΣΜΗΣΗ', 'Κεριά'],
    'ρολογ': ['ΔΙΑΚΟΣΜΗΣΗ', 'Ρολόγια'],
    'χαλι': ['ΔΙΑΚΟΣΜΗΣΗ', 'Χαλιά'],
    'καθρεπτ': ['ΔΙΑΚΟΣΜΗΣΗ', 'Καθρέπτες'],

    // Kitchen
    'οργανωση κουζινας': ['ΚΟΥΖΙΝΑ', 'Οργάνωση'],
    'μαχαιροπιρουνα': ['ΚΟΥΖΙΝΑ', 'Μαχαιροπίρουνα'],
    'εργαλεια κουζινας': ['ΚΟΥΖΙΝΑ', 'Εργαλεία Μαγειρικής'],
    'κατσαρολ': ['ΚΟΥΖΙΝΑ', 'Μαγειρικά Σκεύη'],
    'τηγανι': ['ΚΟΥΖΙΝΑ', 'Μαγειρικά Σκεύη'],
    'πιατα': ['ΚΟΥΖΙΝΑ', 'Σερβίτσια'],
    'ποτηρια': ['ΚΟΥΖΙΝΑ', 'Ποτήρια & Κούπες'],
    'κουπες': ['ΚΟΥΖΙΝΑ', 'Ποτήρια & Κούπες'],
    'καφετιερ': ['ΚΟΥΖΙΝΑ', 'Μηχανές Καφέ'],

    // Kids
    'παιδικο δωματιο': ['ΠΑΙΔΙΚΟ ΔΩΜΑΤΙΟ', 'Παιδικό Έπιπλο'],
    'παιχνιδ': ['ΠΑΙΔΙΚΟ ΔΩΜΑΤΙΟ', 'Παιχνίδια'],
    
    // Uncategorized patterns
    'οικιακες συσκευες': ['ΑΛΛΑ', 'Οικιακές Συσκευές'],
    'μικροσυσκευες': ['ΑΛΛΑ', 'Οικιακές Συσκευές'],
    'αξεσουαρ μπανιου': ['ΑΛΛΑ', 'Αξεσουάρ Μπάνιου'],
};

// Normalizes the raw category string for easier matching
function normalize(str: string): string {
  if (!str) return "";
  return str.trim().toLowerCase()
    .replace(/[άάὰ]/g, 'α')
    .replace(/[έὲ]/g, 'ε')
    .replace(/[ήὴ]/g, 'η')
    .replace(/[ίϊΐὶ]/g, 'ι')
    .replace(/[όὸ]/g, 'ο')
    .replace(/[ύϋΰὺ]/g, 'υ')
    .replace(/[ώὼ]/g, 'ω')
    .replace(/[^a-zα-ω0-9 >]/gi, ''); // allow > for path separation
}

/**
 * Maps a raw category string to a unified string format "MAIN > SUB".
 * @param raw The raw category string from the supplier feed.
 * @returns A formatted category string.
 */
export function mapCategory(raw: string): string {
    const normalizedRaw = normalize(raw);
    
    for (const key in categoryMap) {
        if (normalizedRaw.includes(key)) {
            const [main, sub] = categoryMap[key];
            return `${main} > ${sub}`;
        }
    }
    
    // Fallback if no specific keyword matches
    const parts = raw.split('>').map(p => p.trim()).filter(Boolean);
    if (parts.length > 1) {
        return parts.slice(0, 2).join(' > ');
    }
    if (parts.length === 1) {
        return `ΑΛΛΑ > ${parts[0]}`;
    }

    return "ΑΛΛΑ > Uncategorized";
}
